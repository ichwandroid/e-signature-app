<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verifikasi Tanda Tangan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="bg-slate-100 antialiased">
    <div class="min-h-screen flex items-center justify-center p-4">
      <div class="w-full max-w-2xl bg-white p-8 rounded-xl shadow-lg">
        <h1
          class="text-2xl font-bold text-slate-800 mb-6 text-center border-b pb-4"
        >
          Verifikasi Tanda Tangan Digital
        </h1>
        <div id="validation-loading" class="text-center text-slate-500">
          <p>Memuat data verifikasi...</p>
        </div>
        <div id="validation-error" class="hidden text-center text-red-500">
          <h2 class="text-xl font-bold mb-2">Data Tidak Ditemukan</h2>
          <p>Link verifikasi tidak valid atau data telah dihapus.</p>
        </div>
        <div id="validation-data" class="hidden">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="md:col-span-2 space-y-4">
              <div class="info-item">
                <p class="text-sm text-slate-500">Nama Dokumen</p>
                <p
                  id="val-documentName"
                  class="font-semibold text-slate-800"
                ></p>
              </div>
              <div class="info-item">
                <p class="text-sm text-slate-500">Nama Penanda Tangan</p>
                <p id="val-signerName" class="font-semibold text-slate-800"></p>
              </div>
              <div class="info-item">
                <p class="text-sm text-slate-500">Jabatan</p>
                <p id="val-position" class="font-semibold text-slate-800"></p>
              </div>
              <div class="info-item">
                <p class="text-sm text-slate-500">NIY</p>
                <p
                  id="val-foundationId"
                  class="font-semibold text-slate-800"
                ></p>
              </div>
              <div class="info-item">
                <p class="text-sm text-slate-500">Nomer SK</p>
                <p
                  id="val-decreeNumber"
                  class="font-semibold text-slate-800"
                ></p>
              </div>
              <div class="info-item">
                <p class="text-sm text-slate-500">Tanggal Dibuat</p>
                <p id="val-timestamp" class="font-semibold text-slate-800"></p>
              </div>
            </div>
            <div
              class="md:col-span-1 flex flex-col items-center justify-center space-y-2"
            >
              <p class="text-sm text-slate-500">Tanda Tangan</p>
              <img
                id="val-signatureImage"
                src=""
                alt="Tanda Tangan"
                class="border rounded-md p-2 w-full"
              />
              <div class="mt-4 flex items-center space-x-2 text-green-600">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
                </svg>
                <span class="font-bold">TERVERIFIKASI</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getFirestore,
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyB_eFnAlQDAABFc_F_Vzaj3gfiynp-e5OQ",
        authDomain: "sekolahanaksaleh-esign.firebaseapp.com",
        projectId: "sekolahanaksaleh-esign",
        storageBucket: "sekolahanaksaleh-esign.firebasestorage.app",
        messagingSenderId: "196646097242",
        appId: "1:196646097242:web:e50cec36c234f35c9ca363",
      };
      const appId =
        typeof __app_id !== "undefined" ? __app_id : "default-e-signature-app";

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      const ui = {
        loading: document.getElementById("validation-loading"),
        error: document.getElementById("validation-error"),
        data: document.getElementById("validation-data"),
      };

      async function loadValidationData() {
        const params = new URLSearchParams(window.location.search);
        const validationId = params.get("id");

        if (!validationId) {
          ui.loading.style.display = "none";
          ui.error.style.display = "block";
          return;
        }

        try {
          const docPath = `/artifacts/${appId}/public/data/validations/${validationId}`;
          const docRef = doc(db, docPath);
          const docSnap = await getDoc(docRef);

          if (docSnap.exists()) {
            const data = docSnap.data();
            document.getElementById("val-documentName").textContent =
              data.documentName || "-";
            document.getElementById("val-signerName").textContent =
              data.signerName || "-";
            document.getElementById("val-position").textContent =
              data.position || "-";
            document.getElementById("val-foundationId").textContent =
              data.foundationId || "-";
            document.getElementById("val-decreeNumber").textContent =
              data.decreeNumber || "-";
            document.getElementById("val-signatureImage").src =
              data.signatureImage || "";
            document.getElementById("val-timestamp").textContent =
              data.createdAt?.toDate()
                ? data.createdAt.toDate().toLocaleString("id-ID")
                : "N/A";

            ui.loading.style.display = "none";
            ui.data.style.display = "block";
          } else {
            ui.loading.style.display = "none";
            ui.error.style.display = "block";
          }
        } catch (error) {
          console.error("Validation Error:", error);
          ui.loading.style.display = "none";
          ui.error.style.display = "block";
        }
      }

      window.addEventListener("load", loadValidationData);
    </script>
  </body>
</html>
